// Prisma schema for MongoDB
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Application {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Applicant Information
  applicantName     String
  email             String
  phone             String
  position          String
  yearsOfExperience Int
  availabilityDate  DateTime?
  currentLocation   String?
  arabicProficiency String?
  englishProficiency String?
  consentToDataUsage Boolean @default(false)

  // Optional URLs
  portfolioUrl String?
  githubUrl    String?
  linkedinUrl  String?

  // Skills and Documents
  skills       String[] // Array of skill strings
  coverLetter  String
  cvUrl        String   // Cloudinary URL
  cvPublicId   String   // Cloudinary public ID for deletion
  
  // Personal Image
  profileImageUrl String // Cloudinary URL for profile image (required)
  profileImagePublicId String // Cloudinary public ID for deletion (required)

  // Application Status
  status     ApplicationStatus @default(PENDING)
  adminNotes String?

  // Interview Response
  lastJobExitReason          String?
  lastSalary                 String?
  expectedSalary             String?
  canWorkHard                Boolean?
  noticePeriod               String?
  preferredWorkLocation      String?
  whyInterestedInPosition    String?
  questionsAboutRole         String?
  willingnessToRelocate      Boolean?
  bestInterviewTime          String?
  interviewResponseSubmittedAt DateTime?

  // Metadata
  locale String @default("ar") // ar or en

  @@index([status])
  @@index([position])
  @@index([email])
  @@index([createdAt])
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  ACCEPTED
  REJECTED
}

model Phase1Requirement {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  category    String
  title       String
  status      RequirementStatus @default(PENDING)
  priority    RequirementPriority
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([category])
  @@index([status])
}

enum RequirementStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum RequirementPriority {
  HIGH
  MEDIUM
  LOW
}

model Transaction {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Transaction Details
  type        TransactionType
  amount      Float
  description String
  category    String?
  date        DateTime

  // Invoice Image (for expenses only)
  invoiceImageUrl    String?
  invoiceImagePublicId String?

  @@index([type])
  @@index([date])
  @@index([category])
  @@index([createdAt])
}

enum TransactionType {
  EXPENSE
  REVENUE
}

model ContactMessage {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  fullName String
  email    String
  phone    String?
  subject  String
  message  String
  locale   String  @default("en")
  source   String  @default("contact-form")

  @@index([createdAt])
  @@index([locale])
}

